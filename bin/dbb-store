#!/bin/bash

# Dawn Black Box CLI
INSTALL_DIR="$HOME/.black-box-store"
PORT=3456

if [ ! -d "$INSTALL_DIR" ]; then
    echo "Error: Black Box Store not installed. Please run install.sh first."
    exit 1
fi

echo "========================================"
echo "  Dawn Black Box Store"
echo "========================================"
echo ""
echo "Starting server on http://localhost:$PORT"
echo "Press Ctrl+C to stop"
echo ""

cd "$INSTALL_DIR"

# Start the Next.js server in the background
PORT=$PORT npm start &
SERVER_PID=$!

# Wait for server to be ready
sleep 3

# Open browser
if [[ "$OSTYPE" == "darwin"* ]]; then
    # macOS
    open "http://localhost:$PORT"
elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
    # Linux
    if command -v xdg-open &> /dev/null; then
        xdg-open "http://localhost:$PORT"
    elif command -v gnome-open &> /dev/null; then
        gnome-open "http://localhost:$PORT"
    fi
fi

echo "Server running with PID $SERVER_PID"
echo ""
echo "Open your browser to: http://localhost:$PORT"
echo ""

# Wait for the server process
wait $SERVER_PID

